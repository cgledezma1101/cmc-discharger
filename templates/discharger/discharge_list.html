{% extends "base.html" %}
{% comment %}
  This view displays the list of discharges that haven't ended.

  Parameters:
    [list<Discharge>] discharges A list of all the discharges that will be
      displayed
    [list<Stage>] stages A list of all the stages that a discharge has to go
      through
    [int] stage_size The size in pixels that a stage's navigation bar should
      occupy
{% endcomment %}

{% block title %}Listado de altas{% endblock %}

{% block stylesheets %}
  {% load staticfiles %}
  <link rel='stylesheet'
        type='text/css'
        href='{% static "stylesheets/discharger/discharge_list.css" %}' />
{% endblock %}

{% block javascripts %}
  {% load staticfiles %}
  <script src='{% static "javascripts/discharger/discharge_list.js" %}'>
  </script>
{% endblock %}

{% block content %}
  {% load helper_filters %}
  <div class='panel panel-primary'>
    <div class='panel-heading'>
      <h1>Listado de altas</h3>
    </div>

    <div class='panel-body'>
      <table class='table table-striped table-hover'>
        <tbody>
          <tr>
            <th>UBICACIÃ“N</th>
            <th>PACIENTE</th>
            <th>ETAPA</th>
            <th>TIEMPO DE ALTA</th>
          </tr>

          {% for discharge in discharges %}
            <tr>
              <td>{{ discharge.location }}</td>

              <td>{{ discharge.patient_name }}</td>

              <td class='td-progress'>
                <div class='arrow_box'>
                  <div class='arrow-box-header'>
                    <h4> Administrar etapas </h4>
                  </div>

                  <hr />

                  <div class='arrow-box-body'>
                    {% for stage in discharge.stages.all %}
                      <div class='stage-checkbox-div'>
                        <input class='stage-checkbox'
                               id='{{ stage.id }}'
                               type='checkbox' />
                        <span>{{ stage.name }}</span>
                      </div>
                    {% endfor %}
                  </div>
                </div>
                {% for stage in discharge.stages.all %}
                  <div 
                    {% if forloop.first %}
                      class='progress first'
                    {% else %}
                      {% if forloop.last %}
                        class='progress last'
                      {% else %}
                        class='progress'
                      {% endif %}
                    {% endif %}
                       style=
                         'width: 
                           {{ discharge.stages.all | divide_in:600 }}px;'>
                    <div class='progress-bar'
                         id='{{ stage.id }}'
                         role='progressbar'
                         style='width: 0%'>
                      <p class='stage-name'>
                        {{ stage.name }}
                      </p>
                    </div>
                  </div>
                {% endfor %}
              </td>

              <td class='td-time'>
                <div class='progress progress-striped active'>
                  <div 
                    class='progress-bar time-in-process'
                    data-time=
                      '{{ discharge.start_time | seconds_from }}'
                    style='width: 100%'>
                  </div>
                </div>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% endblock %}
